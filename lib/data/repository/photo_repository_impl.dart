import 'dart:convert';

import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'package:unsplash_viewer_flutter/data/model/photo.dart';
import 'package:unsplash_viewer_flutter/data/model/result.dart';
import 'package:unsplash_viewer_flutter/data/remote/photo_data_source.dart';
import 'package:unsplash_viewer_flutter/data/repository/photo_repository.dart';
import 'package:hooks_riverpod/hooks_riverpod.dart';

final photoRepositoryProvider =
    Provider((ref) => PhotoRepositoryImpl(ref.read));

class PhotoRepositoryImpl implements PhotoRepository {
  PhotoRepositoryImpl(this._reader);

  final Reader _reader;

  late final PhotoDataSource _dataSource = _reader(photoDataSourceProvider);

  @override
  Future<Result<List<Photo>>> getPhotos() {
    return Result.guardFuture(
      () async => await _dataSource.getPhotos(),
    );
    // final list = List<Map<String, dynamic>>.from(
    //     json.decode(kUnsplashSampleResponse) as Iterable<dynamic>);
    // final ps = list.map((e) => Photo.fromJson(e)).toList();
    // return Result.guardFuture(() => Future.value(ps));
  }
}

String kUnsplashSampleResponse =
    '[    {        "id": "VGDaRSGZbww",        "width": 8688,        "height": 5792,        "urls": {            "raw": "https://images.unsplash.com/photo-1621570072081-b780ce69bff0?ixid=MnwyMzU2Nzd8MXwxfGFsbHwxfHx8fHx8Mnx8MTYyNDA3OTU0NA\u0026ixlib=rb-1.2.1",            "full": "https://images.unsplash.com/photo-1621570072081-b780ce69bff0?crop=entropy\u0026cs=srgb\u0026fm=jpg\u0026ixid=MnwyMzU2Nzd8MXwxfGFsbHwxfHx8fHx8Mnx8MTYyNDA3OTU0NA\u0026ixlib=rb-1.2.1\u0026q=85",            "regular": "https://images.unsplash.com/photo-1621570072081-b780ce69bff0?crop=entropy\u0026cs=tinysrgb\u0026fit=max\u0026fm=jpg\u0026ixid=MnwyMzU2Nzd8MXwxfGFsbHwxfHx8fHx8Mnx8MTYyNDA3OTU0NA\u0026ixlib=rb-1.2.1\u0026q=80\u0026w=1080",            "small": "https://images.unsplash.com/photo-1621570072081-b780ce69bff0?crop=entropy\u0026cs=tinysrgb\u0026fit=max\u0026fm=jpg\u0026ixid=MnwyMzU2Nzd8MXwxfGFsbHwxfHx8fHx8Mnx8MTYyNDA3OTU0NA\u0026ixlib=rb-1.2.1\u0026q=80\u0026w=400",            "thumb": "https://images.unsplash.com/photo-1621570072081-b780ce69bff0?crop=entropy\u0026cs=tinysrgb\u0026fit=max\u0026fm=jpg\u0026ixid=MnwyMzU2Nzd8MXwxfGFsbHwxfHx8fHx8Mnx8MTYyNDA3OTU0NA\u0026ixlib=rb-1.2.1\u0026q=80\u0026w=200"        }    },    {        "id": "AXku9x__cBY",        "width": 3748,        "height": 5622,        "urls": {            "raw": "https://images.unsplash.com/photo-1623851692918-dc43ab783b12?ixid=MnwyMzU2Nzd8MHwxfGFsbHwyfHx8fHx8Mnx8MTYyNDA3OTU0NA\u0026ixlib=rb-1.2.1",            "full": "https://images.unsplash.com/photo-1623851692918-dc43ab783b12?crop=entropy\u0026cs=srgb\u0026fm=jpg\u0026ixid=MnwyMzU2Nzd8MHwxfGFsbHwyfHx8fHx8Mnx8MTYyNDA3OTU0NA\u0026ixlib=rb-1.2.1\u0026q=85",            "regular": "https://images.unsplash.com/photo-1623851692918-dc43ab783b12?crop=entropy\u0026cs=tinysrgb\u0026fit=max\u0026fm=jpg\u0026ixid=MnwyMzU2Nzd8MHwxfGFsbHwyfHx8fHx8Mnx8MTYyNDA3OTU0NA\u0026ixlib=rb-1.2.1\u0026q=80\u0026w=1080",            "small": "https://images.unsplash.com/photo-1623851692918-dc43ab783b12?crop=entropy\u0026cs=tinysrgb\u0026fit=max\u0026fm=jpg\u0026ixid=MnwyMzU2Nzd8MHwxfGFsbHwyfHx8fHx8Mnx8MTYyNDA3OTU0NA\u0026ixlib=rb-1.2.1\u0026q=80\u0026w=400",            "thumb": "https://images.unsplash.com/photo-1623851692918-dc43ab783b12?crop=entropy\u0026cs=tinysrgb\u0026fit=max\u0026fm=jpg\u0026ixid=MnwyMzU2Nzd8MHwxfGFsbHwyfHx8fHx8Mnx8MTYyNDA3OTU0NA\u0026ixlib=rb-1.2.1\u0026q=80\u0026w=200"        }    },    {        "id": "VGDaRSGZbww",        "width": 8688,        "height": 5792,        "urls": {            "raw": "https://images.unsplash.com/photo-1621570072081-b780ce69bff0?ixid=MnwyMzU2Nzd8MXwxfGFsbHwxfHx8fHx8Mnx8MTYyNDA3OTU0NA\u0026ixlib=rb-1.2.1",            "full": "https://images.unsplash.com/photo-1621570072081-b780ce69bff0?crop=entropy\u0026cs=srgb\u0026fm=jpg\u0026ixid=MnwyMzU2Nzd8MXwxfGFsbHwxfHx8fHx8Mnx8MTYyNDA3OTU0NA\u0026ixlib=rb-1.2.1\u0026q=85",            "regular": "https://images.unsplash.com/photo-1621570072081-b780ce69bff0?crop=entropy\u0026cs=tinysrgb\u0026fit=max\u0026fm=jpg\u0026ixid=MnwyMzU2Nzd8MXwxfGFsbHwxfHx8fHx8Mnx8MTYyNDA3OTU0NA\u0026ixlib=rb-1.2.1\u0026q=80\u0026w=1080",            "small": "https://images.unsplash.com/photo-1621570072081-b780ce69bff0?crop=entropy\u0026cs=tinysrgb\u0026fit=max\u0026fm=jpg\u0026ixid=MnwyMzU2Nzd8MXwxfGFsbHwxfHx8fHx8Mnx8MTYyNDA3OTU0NA\u0026ixlib=rb-1.2.1\u0026q=80\u0026w=400",            "thumb": "https://images.unsplash.com/photo-1621570072081-b780ce69bff0?crop=entropy\u0026cs=tinysrgb\u0026fit=max\u0026fm=jpg\u0026ixid=MnwyMzU2Nzd8MXwxfGFsbHwxfHx8fHx8Mnx8MTYyNDA3OTU0NA\u0026ixlib=rb-1.2.1\u0026q=80\u0026w=200"        }    },    {        "id": "AXku9x__cBY",        "width": 3748,        "height": 5622,        "urls": {            "raw": "https://images.unsplash.com/photo-1623851692918-dc43ab783b12?ixid=MnwyMzU2Nzd8MHwxfGFsbHwyfHx8fHx8Mnx8MTYyNDA3OTU0NA\u0026ixlib=rb-1.2.1",            "full": "https://images.unsplash.com/photo-1623851692918-dc43ab783b12?crop=entropy\u0026cs=srgb\u0026fm=jpg\u0026ixid=MnwyMzU2Nzd8MHwxfGFsbHwyfHx8fHx8Mnx8MTYyNDA3OTU0NA\u0026ixlib=rb-1.2.1\u0026q=85",            "regular": "https://images.unsplash.com/photo-1623851692918-dc43ab783b12?crop=entropy\u0026cs=tinysrgb\u0026fit=max\u0026fm=jpg\u0026ixid=MnwyMzU2Nzd8MHwxfGFsbHwyfHx8fHx8Mnx8MTYyNDA3OTU0NA\u0026ixlib=rb-1.2.1\u0026q=80\u0026w=1080",            "small": "https://images.unsplash.com/photo-1623851692918-dc43ab783b12?crop=entropy\u0026cs=tinysrgb\u0026fit=max\u0026fm=jpg\u0026ixid=MnwyMzU2Nzd8MHwxfGFsbHwyfHx8fHx8Mnx8MTYyNDA3OTU0NA\u0026ixlib=rb-1.2.1\u0026q=80\u0026w=400",            "thumb": "https://images.unsplash.com/photo-1623851692918-dc43ab783b12?crop=entropy\u0026cs=tinysrgb\u0026fit=max\u0026fm=jpg\u0026ixid=MnwyMzU2Nzd8MHwxfGFsbHwyfHx8fHx8Mnx8MTYyNDA3OTU0NA\u0026ixlib=rb-1.2.1\u0026q=80\u0026w=200"        }    },    {        "id": "VGDaRSGZbww",        "width": 8688,        "height": 5792,        "urls": {            "raw": "https://images.unsplash.com/photo-1621570072081-b780ce69bff0?ixid=MnwyMzU2Nzd8MXwxfGFsbHwxfHx8fHx8Mnx8MTYyNDA3OTU0NA\u0026ixlib=rb-1.2.1",            "full": "https://images.unsplash.com/photo-1621570072081-b780ce69bff0?crop=entropy\u0026cs=srgb\u0026fm=jpg\u0026ixid=MnwyMzU2Nzd8MXwxfGFsbHwxfHx8fHx8Mnx8MTYyNDA3OTU0NA\u0026ixlib=rb-1.2.1\u0026q=85",            "regular": "https://images.unsplash.com/photo-1621570072081-b780ce69bff0?crop=entropy\u0026cs=tinysrgb\u0026fit=max\u0026fm=jpg\u0026ixid=MnwyMzU2Nzd8MXwxfGFsbHwxfHx8fHx8Mnx8MTYyNDA3OTU0NA\u0026ixlib=rb-1.2.1\u0026q=80\u0026w=1080",            "small": "https://images.unsplash.com/photo-1621570072081-b780ce69bff0?crop=entropy\u0026cs=tinysrgb\u0026fit=max\u0026fm=jpg\u0026ixid=MnwyMzU2Nzd8MXwxfGFsbHwxfHx8fHx8Mnx8MTYyNDA3OTU0NA\u0026ixlib=rb-1.2.1\u0026q=80\u0026w=400",            "thumb": "https://images.unsplash.com/photo-1621570072081-b780ce69bff0?crop=entropy\u0026cs=tinysrgb\u0026fit=max\u0026fm=jpg\u0026ixid=MnwyMzU2Nzd8MXwxfGFsbHwxfHx8fHx8Mnx8MTYyNDA3OTU0NA\u0026ixlib=rb-1.2.1\u0026q=80\u0026w=200"        }    },    {        "id": "AXku9x__cBY",        "width": 3748,        "height": 5622,        "urls": {            "raw": "https://images.unsplash.com/photo-1623851692918-dc43ab783b12?ixid=MnwyMzU2Nzd8MHwxfGFsbHwyfHx8fHx8Mnx8MTYyNDA3OTU0NA\u0026ixlib=rb-1.2.1",            "full": "https://images.unsplash.com/photo-1623851692918-dc43ab783b12?crop=entropy\u0026cs=srgb\u0026fm=jpg\u0026ixid=MnwyMzU2Nzd8MHwxfGFsbHwyfHx8fHx8Mnx8MTYyNDA3OTU0NA\u0026ixlib=rb-1.2.1\u0026q=85",            "regular": "https://images.unsplash.com/photo-1623851692918-dc43ab783b12?crop=entropy\u0026cs=tinysrgb\u0026fit=max\u0026fm=jpg\u0026ixid=MnwyMzU2Nzd8MHwxfGFsbHwyfHx8fHx8Mnx8MTYyNDA3OTU0NA\u0026ixlib=rb-1.2.1\u0026q=80\u0026w=1080",            "small": "https://images.unsplash.com/photo-1623851692918-dc43ab783b12?crop=entropy\u0026cs=tinysrgb\u0026fit=max\u0026fm=jpg\u0026ixid=MnwyMzU2Nzd8MHwxfGFsbHwyfHx8fHx8Mnx8MTYyNDA3OTU0NA\u0026ixlib=rb-1.2.1\u0026q=80\u0026w=400",            "thumb": "https://images.unsplash.com/photo-1623851692918-dc43ab783b12?crop=entropy\u0026cs=tinysrgb\u0026fit=max\u0026fm=jpg\u0026ixid=MnwyMzU2Nzd8MHwxfGFsbHwyfHx8fHx8Mnx8MTYyNDA3OTU0NA\u0026ixlib=rb-1.2.1\u0026q=80\u0026w=200"        }    },    {        "id": "VGDaRSGZbww",        "width": 8688,        "height": 5792,        "urls": {            "raw": "https://images.unsplash.com/photo-1621570072081-b780ce69bff0?ixid=MnwyMzU2Nzd8MXwxfGFsbHwxfHx8fHx8Mnx8MTYyNDA3OTU0NA\u0026ixlib=rb-1.2.1",            "full": "https://images.unsplash.com/photo-1621570072081-b780ce69bff0?crop=entropy\u0026cs=srgb\u0026fm=jpg\u0026ixid=MnwyMzU2Nzd8MXwxfGFsbHwxfHx8fHx8Mnx8MTYyNDA3OTU0NA\u0026ixlib=rb-1.2.1\u0026q=85",            "regular": "https://images.unsplash.com/photo-1621570072081-b780ce69bff0?crop=entropy\u0026cs=tinysrgb\u0026fit=max\u0026fm=jpg\u0026ixid=MnwyMzU2Nzd8MXwxfGFsbHwxfHx8fHx8Mnx8MTYyNDA3OTU0NA\u0026ixlib=rb-1.2.1\u0026q=80\u0026w=1080",            "small": "https://images.unsplash.com/photo-1621570072081-b780ce69bff0?crop=entropy\u0026cs=tinysrgb\u0026fit=max\u0026fm=jpg\u0026ixid=MnwyMzU2Nzd8MXwxfGFsbHwxfHx8fHx8Mnx8MTYyNDA3OTU0NA\u0026ixlib=rb-1.2.1\u0026q=80\u0026w=400",            "thumb": "https://images.unsplash.com/photo-1621570072081-b780ce69bff0?crop=entropy\u0026cs=tinysrgb\u0026fit=max\u0026fm=jpg\u0026ixid=MnwyMzU2Nzd8MXwxfGFsbHwxfHx8fHx8Mnx8MTYyNDA3OTU0NA\u0026ixlib=rb-1.2.1\u0026q=80\u0026w=200"        }    },    {        "id": "AXku9x__cBY",        "width": 3748,        "height": 5622,        "urls": {            "raw": "https://images.unsplash.com/photo-1623851692918-dc43ab783b12?ixid=MnwyMzU2Nzd8MHwxfGFsbHwyfHx8fHx8Mnx8MTYyNDA3OTU0NA\u0026ixlib=rb-1.2.1",            "full": "https://images.unsplash.com/photo-1623851692918-dc43ab783b12?crop=entropy\u0026cs=srgb\u0026fm=jpg\u0026ixid=MnwyMzU2Nzd8MHwxfGFsbHwyfHx8fHx8Mnx8MTYyNDA3OTU0NA\u0026ixlib=rb-1.2.1\u0026q=85",            "regular": "https://images.unsplash.com/photo-1623851692918-dc43ab783b12?crop=entropy\u0026cs=tinysrgb\u0026fit=max\u0026fm=jpg\u0026ixid=MnwyMzU2Nzd8MHwxfGFsbHwyfHx8fHx8Mnx8MTYyNDA3OTU0NA\u0026ixlib=rb-1.2.1\u0026q=80\u0026w=1080",            "small": "https://images.unsplash.com/photo-1623851692918-dc43ab783b12?crop=entropy\u0026cs=tinysrgb\u0026fit=max\u0026fm=jpg\u0026ixid=MnwyMzU2Nzd8MHwxfGFsbHwyfHx8fHx8Mnx8MTYyNDA3OTU0NA\u0026ixlib=rb-1.2.1\u0026q=80\u0026w=400",            "thumb": "https://images.unsplash.com/photo-1623851692918-dc43ab783b12?crop=entropy\u0026cs=tinysrgb\u0026fit=max\u0026fm=jpg\u0026ixid=MnwyMzU2Nzd8MHwxfGFsbHwyfHx8fHx8Mnx8MTYyNDA3OTU0NA\u0026ixlib=rb-1.2.1\u0026q=80\u0026w=200"        }    }]';
